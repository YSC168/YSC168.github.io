---
title: 多合一收款二维码原理及实现
date: 2018-12-12 20:34:09
tags: 分享
categories: 抄录
---
> [DEMO][1]

无论是支付宝还是微信的收款码，其本质上是一个包含了收款链接的二维码。所以我们的思路是：检测如果是支付宝浏览页面，就给出支付宝的付款链接、如果是微信，就给出微信链接……

那么问题来了，如何进行判定呢？
<!--more-->
很好办，根据 UA 就能进行判定了！不懂什么是 UA？请参照 浏览器野史 – UserAgent列传 这篇博文。

这是部分的代码如下：

    if(navigator.userAgent.match(/Alipay/i)) {
    // 支付宝
    } else if(navigator.userAgent.match(/MicroMessenger\//i)) {
    // 微信
    } else if(navigator.userAgent.match(/QQ\//i)) {
    // QQ
    } else {
    // 其它
    }
    
    
理论上来说，进行判定后直接给跳转到对应的收款页面就行了，然而实际测试发现在QQ和微信中并不能直接调用付款功能，只有支付宝能直接进行付款。

这里就只能用一个折中的办法：如果是QQ或微信扫的码，就再放出一个二维码的界面，让用户通过长按识别二维码进入支付流程。

最终完成的效果如下：

![此处输入图片的描述][2]

你可以用 **QQ** 或是**微信**或是**支付宝**中的任意一个扫描这个二维码进行测试(当然如果还打个款就再好不过了，哈哈哈哈……  )

成品源码下载(单文件纯 html 实现，需上传至网站空间使用)：

[百度网盘][3]

> 收款链接获取方法

 - 打开微信，点击右上角>收付款
 - 找到“二维码收款”
 - 将得到的收款二维码保存(截图)
 - 用二维码识别工具(如 https://cli.im/deqr/) 上传二维码图片并获取到二维码中的收款链接。

本文转载至[mengkun][4]。


  [1]: https://yscblog.top/pay/
  [2]: http://img01.sogoucdn.com/app/a/100520146/36985a89ae4844235be98b668dfb1d5a
  [3]: https://pan.baidu.com/s/1BEkI7BQpVNH37ZlYf77vDg
  [4]: https://mkblog.cn/922/